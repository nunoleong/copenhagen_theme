import{i as e,a as n,r as t,j as s,F as a,L as r,S as o,H as l,I as i,M as c,u,b as d,N as m,T as p,C as h,s as f,c as j,d as b,e as g,f as x,g as v,O as y,h as w,k,l as _,p as C,n as q,o as S,q as T,P as F,A as I,t as P,v as R,D as $,w as L,K as E,x as M,y as D,z as V,B as z,E as A,G as N,$ as G,J as U,Q as H,R as O,U as X,V as B,W,X as Y,Y as J,Z as K,_ as Z,a0 as Q,a1 as ee,a2 as ne,a3 as te}from"shared";import{F as se,M as ae,T as re,c as oe}from"ThemeProviders";function le(e){try{const n=window.sessionStorage.getItem(se),t=n?JSON.parse(n):[];t.push(e),window.sessionStorage.setItem(se,JSON.stringify(t))}catch(e){console.error("Cannot add flash notification",e)}}function ie({field:e,onChange:n}){const{label:t,error:u,value:d,name:m,required:p,description:h,type:f}=e,j={},b="integer"===f||"decimal"===f?"number":"text";"integer"===f&&(j.step="1"),"decimal"===f&&(j.step="any");const g="anonymous_requester_email"===f?"email":void 0;return s.jsxs(a,{children:[s.jsxs(r,{children:[t,p&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),h&&s.jsx(l,{dangerouslySetInnerHTML:{__html:h}}),s.jsx(i,{name:m,type:b,defaultValue:d,validation:u?"error":void 0,required:p,onChange:e=>{n&&n(e.target.value)},autoComplete:g,...j}),u&&s.jsx(c,{validation:"error",children:u})]})}const ce=f(a)`
  .ck.ck-editor {
    margin-top: ${e=>e.theme.space.xs};
  }
`,ue=f(c)`
  .ck.ck-editor + & {
    margin-top: ${e=>e.theme.space.xs};
  }
`;function de({field:e,hasWysiwyg:n,baseLocale:a,hasAtMentions:i,userRole:c,brandId:f,onChange:b}){const{label:g,error:x,value:v,name:y,required:w,description:k}=e,_=function({hasWysiwyg:e,baseLocale:n,hasAtMentions:a,userRole:r,brandId:o}){const l=t.useRef(!1),{addToast:i}=u(),{t:c}=d();return t.useCallback(async t=>{if(e&&t&&!l.current){l.current=!0;const{createEditor:e}=await import("shared").then(function(e){return e.m});(await e(t,{editorType:"supportRequests",hasAtMentions:a,userRole:r,brandId:o,baseLocale:n})).plugins.get("Notification").on("show",(e,n)=>{e.stop();const t=n.message instanceof Error?n.message.message:n.message,{type:a,title:r}=n;i(({close:e})=>s.jsxs(m,{type:a,children:[s.jsx(p,{children:r}),t,s.jsx(h,{"aria-label":c("new-request-form.close-label","Close"),onClick:e})]}))})}},[e,n,a,r,o,i,c])}({hasWysiwyg:n,baseLocale:a,hasAtMentions:i,userRole:c,brandId:f});return s.jsxs(ce,{children:[s.jsxs(r,{children:[g,w&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),k&&s.jsx(l,{dangerouslySetInnerHTML:{__html:k}}),s.jsx(j,{ref:_,name:y,defaultValue:v,validation:x?"error":void 0,required:w,onChange:e=>b(e.target.value),rows:6,isResizable:!0}),x&&s.jsx(ue,{validation:"error",children:x})]})}function me(){const{t:e}=d();return s.jsxs(s.Fragment,{children:[s.jsx(o,{"aria-hidden":"true",children:"-"}),s.jsx(o,{hidden:!0,children:e("new-request-form.dropdown.empty-option","Select an option")})]})}function pe({field:e,onChange:n}){const{label:a,options:r,error:l,value:i,name:c,required:u,description:d}=e,m=null==i?"":i.toString(),p=t.useRef(null);return t.useEffect(()=>{if(p.current&&u){const e=p.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}},[p,u]),s.jsxs(b,{children:[s.jsxs(g,{children:[a,u&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),d&&s.jsx(x,{dangerouslySetInnerHTML:{__html:d}}),s.jsxs(v,{ref:p,inputProps:{name:c,required:u},isEditable:!1,validation:l?"error":void 0,inputValue:m,selectionValue:m,renderValue:({selection:e})=>e?.label||s.jsx(me,{}),onChange:({selectionValue:e})=>{void 0!==e&&n(e)},children:[!u&&s.jsx(y,{value:"",label:"-",children:s.jsx(me,{})}),r.map(e=>s.jsx(y,{value:e.value.toString(),label:e.name},e.value))]}),l&&s.jsx(w,{validation:"error",children:l})]})}function he({field:e,onChange:n}){const{label:i,error:u,value:d,name:m,required:p,description:h}=e,[f,j]=t.useState(d);return s.jsxs(a,{children:[s.jsx("input",{type:"hidden",name:m,value:"off"}),s.jsxs(k,{name:m,required:p,defaultChecked:d,value:f?"on":"off",onChange:e=>{const{checked:t}=e.target;j(t),n(t)},children:[s.jsxs(r,{children:[i,p&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),h&&s.jsx(l,{dangerouslySetInnerHTML:{__html:h}})]}),u&&s.jsx(c,{validation:"error",children:u})]})}const fe="[]";function je(e){return`[${e.join("::")}]`}function be(e){return e.startsWith("[")&&e.endsWith("]")}function ge(e){const n=je(e.slice(0,-1));return{type:"SubGroup",name:e[e.length-1],backOption:{type:"previous",label:"Back",value:n},options:[]}}function xe({options:e,hasEmptyOption:n}){const s=t.useMemo(()=>function(e,n){const t={[fe]:{type:"RootGroup",options:n?[{label:"-",value:""}]:[]}};return e.forEach(e=>{const{name:n,value:s}=e;if(n.includes("::")){const[e,a]=function(e){const n=e.split("::");return[n.slice(0,-1),n.slice(-1)[0]]}(n),r=je(e);t[r]||(t[r]=ge(e)),t[r]?.options.push({value:s,label:n.split("::").join(" > "),menuLabel:a});for(let n=0;n<e.length;n++){const s=e.slice(0,n),a=e.slice(0,n+1),r=je(s),o=je(a);t[r]||(t[r]=ge(s)),void 0===t[r]?.options.find(e=>e.value===o)&&t[r]?.options.push({type:"next",label:a[a.length-1],value:o})}}else t[fe].options.push({value:s,label:n})}),t}(e,n),[e,n]),[a,r]=t.useState(function(e){const n={type:"RootGroup",options:[]};return Object.values(e).forEach(({options:e})=>{n.options.push(...e.filter(({type:e})=>void 0===e))}),n}(s));t.useEffect(()=>{r(s[fe])},[s]);return{currentGroup:a,isGroupIdentifier:be,setCurrentGroupByIdentifier:e=>{const n=s[e];n&&r(n)}}}function ve({field:e}){const{label:n,options:a,error:r,value:l,name:i,required:c,description:u}=e,{currentGroup:d,isGroupIdentifier:m,setCurrentGroupByIdentifier:p}=xe({options:a,hasEmptyOption:!1}),[h,f]=t.useState(l||[]),j=t.useRef(null);t.useEffect(()=>{if(j.current&&c){const e=j.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}},[j,c]);return s.jsxs(b,{children:[h.map(e=>s.jsx("input",{type:"hidden",name:`${i}[]`,value:e},e)),s.jsxs(g,{children:[n,c&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),u&&s.jsx(x,{dangerouslySetInnerHTML:{__html:u}}),s.jsxs(v,{ref:j,isMultiselectable:!0,inputProps:{required:c},isEditable:!1,validation:r?"error":void 0,onChange:e=>{if(Array.isArray(e.selectionValue)){const n=e.selectionValue.slice(-1).toString();m(n)?p(n):f(e.selectionValue)}},selectionValue:h,maxHeight:"auto",children:["SubGroup"===d.type&&s.jsx(y,{...d.backOption}),"SubGroup"===d.type?s.jsx(_,{"aria-label":d.name,children:d.options.map(e=>s.jsx(y,{...e,children:e.menuLabel??e.label},e.value))}):d.options.map(e=>s.jsx(y,{...e},e.value))]}),r&&s.jsx(w,{validation:"error",children:r})]})}const ye="return-focus-to-ticket-form-field";function we({field:e,newRequestPath:n}){const a=t.createRef();return t.useEffect(()=>{sessionStorage.getItem(ye)&&(sessionStorage.removeItem(ye),a.current?.firstChild?.focus())},[]),s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"hidden",name:e.name,value:e.value}),e.options.length>1&&s.jsxs(b,{children:[s.jsx(g,{children:e.label}),s.jsx(v,{isEditable:!1,onChange:({selectionValue:e})=>{if(e&&"number"==typeof e){const t=new URL(window.location.href);t.searchParams.set("ticket_form_id",e),sessionStorage.setItem(ye,"true"),window.location.assign(`${n}${t.search}`)}},ref:a,children:e.options.map(n=>s.jsx(y,{value:n.value,label:n.name,isSelected:e.value===n.value,children:n.name},n.value))})]})]})}function ke({field:e}){const{value:n,name:t}=e;return s.jsx("input",{type:"hidden",name:t,value:n})}function _e(e){const n=t.useRef(!1),s=t.useRef(!1);return{formRefCallback:t.useCallback(t=>{t&&!n.current&&(n.current=!0,t.submit=async()=>{if(!1===s.current){s.current=!0;const n=await async function(){const e=await fetch("/api/v2/help_center/sessions.json"),{current_session:n}=await e.json();return n.csrf_token}(),a=document.createElement("input");a.type="hidden",a.name="authenticity_token",a.value=n,t.appendChild(a);const r=e.filter(e=>"partialcreditcard"===e.type);for(const e of r){const n=t.querySelector(`input[name="${e.name}"]`);n&&n instanceof HTMLInputElement&&4===n.value.length&&(n.value=`XXXXXXXXX${n.value}`)}HTMLFormElement.prototype.submit.call(t)}})},[e]),handleSubmit:e=>{e.preventDefault(),e.target.submit()}}}const Ce=/^\d{4}-\d{2}-\d{2}$/,qe=["true","false"],Se=["pre","strong","b","p","blockquote","ul","ol","li","h2","h3","h4","i","em","br"];function Te(e,n){if(!Number.isNaN(Number(e))){const t=`request[custom_fields][${e}]`;return n.ticketFields.find(e=>e.name===t)}switch(e){case"anonymous_requester_email":return n.emailField;case"due_at":return n.dueDateField;case"collaborators":return n.ccField;case"organization_id":return n.organizationField;default:return n.ticketFields.find(n=>n.name===`request[${e}]`)}}function Fe(e){if(!Ce.test(e))return!1;const n=new Date(e),[t,s,a]=e.split("-").map(Number);return n.getUTCFullYear()===t&&n.getUTCMonth()+1===s&&n.getUTCDate()===a}function Ie({ticketFields:e,ccField:n,dueDateField:s,emailField:a,organizationField:r}){return t.useMemo(()=>function(e){const{href:n}=location,t=new URL(n).searchParams,s={...e,ticketFields:[...e.ticketFields]};if(n.length>2048)return e;if(t.get("parent_id"))return e;for(const[e,n]of t){if(!e.startsWith("tf_"))continue;const t=Te(e.substring(3),s);if(!t)continue;const a=C.sanitize(n,{ALLOWED_TAGS:Se});switch(t.type){case"partialcreditcard":continue;case"multiselect":t.value=a.split(",").filter(e=>t.options.some(n=>n.value===e));break;case"checkbox":qe.includes(a)&&(t.value="true"===a?"on":"false"===a?"off":"");break;case"due_at":case"date":Fe(a)&&(t.value=a);break;default:t.value=a}}return s}({ticketFields:e,ccField:n,dueDateField:s,emailField:a,organizationField:r}),[e,n,s,a,r])}const Pe=f.div`
  flex: 1;
`;function Re({file:e,onRemove:n}){const{t:t}=d(),a=e=>{"Enter"!==e.code&&"Space"!==e.code&&"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),n())},r="pending"===e.status?e.file_name:e.value.file_name,o=t("new-request-form.attachments.stop-upload","Stop upload"),l=t("new-request-form.attachments.remove-file","Remove file");return s.jsx(q.Item,{children:s.jsx(S,{type:"generic",tabIndex:0,"aria-label":t("new-request-form.attachments.file","File: {{fileName}}, press delete to remove",{fileName:r}),onKeyDown:e=>{"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),n())},children:"pending"===e.status?s.jsxs(s.Fragment,{children:[s.jsx(Pe,{children:r}),s.jsx(T,{content:o,children:s.jsx(S.Close,{"aria-label":t("new-request-form.attachments.stop-upload-aria-label","Stop uploading {{fileName}}",{fileName:r}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:a})}),s.jsx(F,{value:e.progress,"aria-label":t("new-request-form.attachments.uploading","Uploading {{fileName}}",{fileName:r})})]}):s.jsxs(s.Fragment,{children:[s.jsx(Pe,{children:s.jsx(I,{isExternal:!0,href:e.value.url,target:"_blank",children:r})}),s.jsx(T,{content:l,children:s.jsx(S.Delete,{"aria-label":t("new-request-form.attachments.remove-file-aria-label","Remove file: {{fileName}}",{fileName:r}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:a})}),s.jsx(F,{value:100,"aria-hidden":"true"})]})})})}async function $e(){const e=await fetch("/api/v2/users/me.json"),{user:{authenticity_token:n}}=await e.json();return n}function Le({field:e}){const{label:n,error:o,name:l,attachments:f}=e,{files:j,addPendingFile:b,setPendingFileProgress:g,setUploaded:x,removePendingFile:v,removeUploadedFile:y}=function(e){const[n,s]=t.useState(e);return{files:n,addPendingFile:t.useCallback((e,n,t)=>{s(s=>[...s,{status:"pending",id:e,file_name:n,progress:0,xhr:t}])},[]),setPendingFileProgress:t.useCallback((e,n)=>{s(t=>t.map(t=>"pending"===t.status&&t.id===e?{...t,progress:n}:t))},[]),removePendingFile:t.useCallback(e=>{s(n=>n.filter(n=>"pending"!==n.status||n.id!==e))},[]),removeUploadedFile:t.useCallback(e=>{s(n=>n.filter(n=>"uploaded"!==n.status||n.value.id!==e))},[]),setUploaded:t.useCallback((e,n)=>{s(t=>t.map(t=>"pending"===t.status&&t.id===e?{status:"uploaded",value:n}:t))},[])}}(f.map(e=>({status:"uploaded",value:e}))??[]),{addToast:w}=u(),{t:k}=d(),_=(e,n)=>{if("RecordInvalid"==n.response?.error&&n.response?.details?.base){const t=n.response?.details?.base?.map(e=>e?.description).join(k("new-request-form.attachments.error-separator","; "));return{title:C(e),errorMessage:t}}return"AttachmentFilenameTooLong"==n.response?.error||"AttachmentTooLarge"==n.response?.error?{title:C(e),errorMessage:n.response?.description}:{title:k("new-request-form.attachments.upload-error-title","Upload error"),errorMessage:k("new-request-form.attachments.upload-error-description","There was an error uploading {{fileName}}. Try again or upload another file.",{fileName:e.name})}},C=e=>k("new-request-form.attachments.upload-failed-title","Upload failed",{fileName:e.name}),S=t.useCallback((e,n)=>{w(({close:t})=>s.jsxs(m,{type:"error",children:[s.jsx(p,{children:e}),n,s.jsx(h,{"aria-label":k("new-request-form.close-label","Close"),onClick:t})]}))},[w,k]),T=t.useCallback(async e=>{const n=await $e();for(const t of e){const e=new XMLHttpRequest,s=new URL(`${window.location.origin}/api/v2/uploads.json`);s.searchParams.append("filename",t.name),e.open("POST",s),t.type?e.setRequestHeader("Content-Type",t.type):e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("X-CSRF-Token",n),e.responseType="json";const a=crypto.randomUUID();b(a,t.name,e),e.upload.addEventListener("progress",({loaded:e,total:n})=>{const t=Math.round(e/n*100);t<=90&&g(a,t)}),e.addEventListener("load",()=>{if(e.status>=200&&e.status<300){const{upload:{attachment:{file_name:n,content_url:t},token:s}}=e.response;x(a,{id:s,file_name:n,url:t})}else{const{title:n,errorMessage:s}=_(t,e);S(n,s),v(a)}}),e.addEventListener("error",()=>{const{title:n,errorMessage:s}=_(t,e);S(n,s),v(a)}),e.send(t)}},[b,v,g,x,S]),{getRootProps:F,getInputProps:I,isDragActive:$}=P({onDrop:T});return s.jsxs(a,{children:[s.jsx(r,{children:n}),o&&s.jsx(c,{validation:"error",children:o}),s.jsxs(R,{...F(),isDragging:$,children:[$?s.jsx("span",{children:k("new-request-form.attachments.drop-files-label","Drop files here")}):s.jsx("span",{children:k("new-request-form.attachments.choose-file-label","Choose a file or drag and drop here")}),s.jsx(i,{...I()})]}),s.jsx(q,{children:j.map(e=>s.jsx(Re,{file:e,onRemove:()=>{(async e=>{if("pending"===e.status)e.xhr.abort(),v(e.id);else{const n=await $e(),t=e.value.id;y(e.value.id),await fetch(`/api/v2/uploads/${t}.json`,{method:"DELETE",headers:{"X-CSRF-Token":n}})}})(e)}},"pending"===e.status?e.id:e.value.id))}),j.map(e=>"uploaded"===e.status&&s.jsx("input",{type:"hidden",name:l,value:JSON.stringify(e.value)},e.value.id))]})}function Ee(e,n){return n.filter(n=>n.child_fields.some(n=>n.id===e))}function Me(e,n,t){return e.filter(e=>{const s=t.find(n=>n.id===e.parent_field_id);if(!s)return!1;const a=Ee(s.id,n);return function(e,n){return"checkbox"===n.parent_field_type&&!1===n.value?!1===e||null===e:e===n.value}(s.value,e)&&(0===a.length||Me(a,n,t).length>0)})}function De(e,n){return 0===n.length?e:e.reduce((t,s)=>{const a=Ee(s.id,n);if(0===a.length)return[...t,s];const r=Me(a,n,e);return r.length>0?[...t,{...s,required:r.some(e=>e.child_fields.some(e=>e.id==s.id&&e.is_required))}]:t},[])}function Ve({field:e,locale:n,valueFormat:u,onChange:d}){const{label:m,error:p,value:h,name:f,required:j,description:b}=e,[g,x]=t.useState(h?new Date(h):void 0),v=t.useCallback(e=>new Intl.DateTimeFormat(n,{month:"long",day:"numeric",year:"numeric",timeZone:"UTC"}).format(e),[n]),y=t.useCallback(e=>{if(void 0===e)return"";const n=e.toISOString();return"dateTime"===u?n:n.split("T")[0]},[u]),w=t.useCallback(e=>{const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));x(n);const t=y(n);void 0!==t&&d(t)},[d,y]);return s.jsxs(a,{children:[s.jsxs(r,{children:[m,j&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),b&&s.jsx(l,{dangerouslySetInnerHTML:{__html:b}}),s.jsx($,{value:g,onChange:w,formatDate:v,locale:n,children:s.jsx(i,{required:j,lang:n,onChange:e=>{""===e.target.value&&(x(void 0),d(""))},validation:p?"error":void 0})}),p&&s.jsx(c,{validation:"error",children:p}),s.jsx("input",{type:"hidden",name:f,value:y(g)})]})}const ze=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Ae=f(D)`
  padding: ${e=>`${e.theme.space.xxs} ${e.theme.space.sm}`};

  // Removes white spaces for inline elements
  font-size: 0;

  // Same as height of Tag size="large" + base space (4px)
  // to give some vertical space between tags
  --line-height: ${e=>8*e.theme.space.base+e.theme.space.base}px;
  line-height: var(--line-height);
`,Ne=f.span`
  display: inline-block;
  margin-right: ${e=>e.theme.space.sm};
`,Ge=f(V)`
  ${e=>M({theme:e.theme,shadowWidth:"sm",selector:"&:focus"})}
`,Ue=f.div`
  display: inline-block;
  position: relative;
`,He=f(D)`
  display: inline-block;
  min-width: 200px;
  opacity: 0;
  user-select: none;
  height: var(--line-height);
  line-height: var(--line-height);
`,Oe=f(i)`
  position: absolute;
  top: 0;
  left: 0;
  height: var(--line-height);
  line-height: var(--line-height);
`;function Xe({field:e}){const{label:n,value:i,name:u,error:m,description:p}=e,{t:h}=d(),f=i?i.split(",").map(e=>e.trim()):[],[j,b]=t.useState(f),[g,x]=t.useState(""),v=t.useRef(null),y=t.useRef(null),{getContainerProps:w,getGridProps:k,getGridRowProps:_,getGridCellProps:C,getTagCloseProps:q,getInputProps:S,getAnnouncementProps:F,announcement:I}=function({tags:e,onTagsChange:n,inputValue:s,onInputValueChange:a,inputRef:r,gridRowRef:o,i18n:l}){const[i,c]=t.useState(0),[u,d]=t.useState(""),m=t.useCallback((e,n)=>{c(n)},[c]),{getGridProps:p,getGridCellProps:h}=L({matrix:[e],rowIndex:0,colIndex:i,onChange:m}),f=n=>e.includes(n),j=t=>{n([...e,t]),d(l.addedTag(t))},b=t=>{const s=e[t];n(e.filter((e,n)=>n!==t)),d(l.removedTag(s)),c(0),setTimeout(()=>{const e=o.current?.querySelector('[tabindex="0"]');e?.focus()},100)},g=e=>{e.target===e.currentTarget&&r.current?.focus()},x=()=>{c(0)},v=e=>{const n=e.target.value;!n||e.key!==E.SPACE&&e.key!==E.ENTER&&e.key!==E.TAB&&e.key!==E.COMMA||(e.preventDefault(),f(n)||j(n),a(""))},y=e=>{const n=e.target.value,[t,s]=[n.slice(0,-1),n.slice(-1)];" "===s||","===s?(t.length>0&&!f(t)&&j(t),a("")):a(n)},w=t=>{t.preventDefault();const s=t.clipboardData.getData("text"),a=new Set(s.split(/[\s,;]+/).filter(n=>!e.includes(n)));n([...e,...a]),d(l.addedTags([...a]))},k=e=>{const n=e.target.value;n&&(f(n)||j(n),a(""))},_=e=>n=>{"Backspace"===n.code&&(n.preventDefault(),b(e))},C=e=>()=>{b(e)};return{getContainerProps:()=>({onClick:g,onBlur:x,tabIndex:-1}),getGridProps:p,getGridRowProps:()=>({role:"row"}),getGridCellProps:e=>h({rowIndex:0,colIndex:e,onKeyDown:_(e)}),getTagCloseProps:e=>({onClick:C(e)}),getInputProps:()=>({value:s,onChange:y,onKeyDown:v,onPaste:w,onBlur:k}),announcement:u,getAnnouncementProps:()=>({"aria-live":"polite","aria-relevant":"text"})}}({tags:j,onTagsChange:b,inputValue:g,onInputValueChange:x,inputRef:v,gridRowRef:y,i18n:{addedTag:e=>h("new-request-form.cc-field.email-added","{{email}} has been added",{email:e}),removedTag:e=>h("new-request-form.cc-field.email-removed","{{email}} has been removed",{email:e}),addedTags:e=>h("new-request-form.cc-field.emails-added","{{emails}} have been added",{emails:e})}}),P=(e,n,t)=>s.jsxs(Ge,{size:"large","aria-label":h("new-request-form.cc-field.email-label","{{email}} - Press Backspace to remove",{email:t}),hue:n?void 0:"red",children:[!n&&s.jsx(V.Avatar,{children:s.jsx(z,{})}),s.jsx("span",{children:t}),s.jsx(V.Close,{...q(e)})]});return s.jsxs(a,{children:[s.jsx(r,{children:n}),p&&s.jsx(l,{children:p}),s.jsxs(Ae,{...w(),children:[j.length>0&&s.jsx("span",{...k({"aria-label":h("new-request-form.cc-field.container-label","Selected CC emails")}),children:s.jsx("span",{ref:y,..._(),children:j.map((e,n)=>{const t=ze.test(e);return t?s.jsx(Ne,{...C(n),children:P(n,t,e)},n):s.jsx(T,{content:h("new-request-form.cc-field.invalid-email","Invalid email address"),children:s.jsx(Ne,{...C(n),children:P(n,t,e)})},n)})})}),s.jsxs(Ue,{children:[s.jsx(He,{isBare:!0,"aria-hidden":"true",tabIndex:-1,children:g}),s.jsx(Oe,{ref:v,isBare:!0,...S()})]})]}),m&&s.jsx(c,{validation:"error",children:m}),j.map(e=>s.jsx("input",{type:"hidden",name:u,value:e},e)),s.jsx(o,{hidden:!0,...F(),children:I})]})}const Be=f(o)`
  margin-left: ${e=>e.theme.space.xxs};
  font-weight: ${e=>e.theme.fontWeights.medium};
`;function We({field:e,onChange:n}){const{t:t}=d(),{label:i,error:u,value:m,name:p,required:h,description:f}=e,j=function(e){return e?e.replaceAll("X",""):""}(m);return s.jsxs(a,{children:[s.jsxs(r,{children:[i,h&&s.jsx(o,{"aria-hidden":"true",children:"*"}),s.jsx(Be,{children:t("new-request-form.credit-card-digits-hint","(Last 4 digits)")})]}),f&&s.jsx(l,{dangerouslySetInnerHTML:{__html:f}}),s.jsx(A,{start:s.jsx(N,{}),name:p,type:"text",value:j,onChange:e=>n(e.target.value),validation:u?"error":void 0,required:h,maxLength:4,placeholder:"XXXX"}),u&&s.jsx(c,{validation:"error",children:u})]})}function Ye({field:e,onChange:n}){const{label:a,options:r,error:l,value:i,name:c,required:u,description:d}=e,{currentGroup:m,isGroupIdentifier:p,setCurrentGroupByIdentifier:h}=xe({options:r,hasEmptyOption:!0}),f=i??"",[j,k]=t.useState(!1),C=t.useRef(null);t.useEffect(()=>{if(C.current&&u){const e=C.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}},[C,u]);return s.jsxs(b,{children:[s.jsxs(g,{children:[a,u&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),d&&s.jsx(x,{dangerouslySetInnerHTML:{__html:d}}),s.jsxs(v,{ref:C,inputProps:{required:u,name:c},isEditable:!1,validation:l?"error":void 0,onChange:e=>{"string"==typeof e.selectionValue&&p(e.selectionValue)?h(e.selectionValue):("string"==typeof e.selectionValue&&n(e.selectionValue),void 0!==e.isExpanded&&k(e.isExpanded))},selectionValue:f,inputValue:f,renderValue:({selection:e})=>e?.label??s.jsx(me,{}),isExpanded:j,children:["SubGroup"===m.type&&s.jsx(y,{...m.backOption}),"SubGroup"===m.type?s.jsx(_,{"aria-label":m.name,children:m.options.map(e=>s.jsx(y,{...e,children:e.menuLabel??e.label},e.value))}):m.options.map(e=>""===e.value?s.jsx(y,{...e,children:s.jsx(me,{})},e.value):s.jsx(y,{...e},e.value))]}),l&&s.jsx(w,{validation:"error",children:l})]})}const Je=G`
  from {
    grid-template-rows: 0fr;
  }
  to {
    grid-template-rows: 1fr;
  }
`,Ke=f.div`
  display: grid;
  animation: ${Je} 200ms forwards;
`,Ze=f.div`
  overflow: hidden;
`,Qe=f.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,en=f.li`
  margin: ${e=>e.theme.space.sm} 0;
`;function nn({query:e,locale:n}){const a=function(e,n){const[s,a]=t.useState(e);return t.useEffect(()=>{const t=setTimeout(()=>a(e),n);return()=>{clearTimeout(t)}},[e,n]),s}(e,500),[r,o]=t.useState([]),l=t.useRef({}),{t:i}=d();return t.useEffect(()=>{const e=a?.trim().toLocaleLowerCase();if(!e||!function(e){const n=e.charCodeAt(0);return n>=19968&&n<=195103?e.length>=2:e.length>=3}(e))return void o([]);const t=new URL(`${window.location.origin}/api/v2/help_center/deflection/suggestions.json`);t.searchParams.append("locale",n),t.searchParams.append("query",e);const s=l.current[t.toString()];s?o(s):fetch(t).then(e=>e.json()).then(({results:e})=>{l.current[t.toString()]=e,o(e)})},[a,n]),r.length>0?s.jsx(Ke,{"data-test-id":"suggested-articles",children:s.jsxs(Ze,{children:[s.jsx("h2",{children:i("new-request-form.suggested-articles","Suggested articles")}),s.jsx(Qe,{children:r.map(e=>s.jsx(en,{children:s.jsx(I,{href:e.html_url,children:e.name})},e.html_url))})]})}):null}const tn=f.h3`
  font-size: ${e=>e.theme.fontSizes.md};
  font-weight: ${e=>e.theme.fontWeights.bold};
`,sn=f(H)`
  color: ${e=>U("successHue",700,e.theme)};
`,an=f(O)`
  position: absolute;
  top: ${e=>5.5*e.theme.space.base}px;
  inset-inline-start: ${e=>4*e.theme.space.base+"px"};
`,rn=f(I)`
  display: inline-block;
  margin-top: ${e=>e.theme.space.sm};
`;function on({authToken:e,interactionAccessToken:n,articles:a,requestId:r,hasRequestManagement:o,isSignedIn:l,helpCenterPath:i,requestsPath:c,requestPath:u}){const[m,p]=t.useState(0),h=function(){const e=t.useContext(ae);if(null===e)throw new Error("useModalContainer should be used inside a ModalContainerProvider");return e}(),{t:f}=d(),j=()=>String(a[m]?.article_id),b=()=>{le({type:"success",message:f("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")}),window.location.assign((()=>{if(l)return o?u:i;{const e=new URLSearchParams;return e.set("return_to",c),`${i}?${e.toString()}`}})())};return s.jsxs(X,{appendToNode:h,onClose:()=>{b()},children:[s.jsxs(sn,{tag:"h2",children:[s.jsx(an,{}),f("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")]}),s.jsxs(B,{children:[s.jsx(tn,{children:f("new-request-form.answer-bot-modal.title","While you wait, do any of these articles answer your question?")}),s.jsx("p",{children:f("new-request-form.answer-bot-modal.footer-content","If it does, we can close your recent request {{requestId}}",{requestId:`‭#${r}‬`})}),s.jsx(W,{level:4,expandedSections:[m],onChange:e=>{p(e)},children:a.map(({article_id:n,html_url:t,snippet:a,title:r})=>s.jsxs(W.Section,{children:[s.jsx(W.Header,{children:s.jsx(W.Label,{children:r})}),s.jsxs(W.Panel,{children:[s.jsx(Y,{dangerouslySetInnerHTML:{__html:a}}),s.jsx(rn,{isExternal:!0,href:`${t}?auth_token=${e}`,target:"_blank",children:f("new-request-form.answer-bot-modal.view-article","View article")})]})]},n))})]}),s.jsxs(J,{children:[s.jsx(K,{children:s.jsx(Z,{onClick:()=>{(async()=>{await fetch("/api/v2/answer_bot/rejection",{method:"POST",body:JSON.stringify({article_id:j(),interaction_access_token:n,reason_id:0}),headers:{"Content-Type":"application/json"}}),b()})()},children:f("new-request-form.answer-bot-modal.mark-irrelevant","No, I need help")})}),s.jsx(K,{children:s.jsx(Z,{isPrimary:!0,onClick:()=>{(async()=>{(await fetch("/api/v2/answer_bot/resolution",{method:"POST",body:JSON.stringify({article_id:j(),interaction_access_token:n}),headers:{"Content-Type":"application/json"}})).ok?le({type:"success",message:f("new-request-form.answer-bot-modal.request-closed","Nice. Your request has been closed.")}):le({type:"error",message:f("new-request-form.answer-bot-modal.solve-error","There was an error closing your request")}),window.location.href=i})()},children:f("new-request-form.answer-bot-modal.solve-request","Yes, close my request")})})]}),s.jsx(Q,{"aria-label":f("new-request-form.close-label","Close")})]})}const ln={value:"",name:"-"};function cn({field:e,userId:n,organizationId:a,onChange:r,visibleFields:l}){const{id:i,label:c,error:u,value:m,name:p,required:h,description:f,relationship_target_type:j}=e,[k,_]=t.useState([]),[C,q]=t.useState(null),[S,T]=t.useState(m),[F,I]=t.useState(!1),{t:P}=d(),R=j.replace("zen:custom_object:","");const $={name:P("new-request-form.lookup-field.loading-options","Loading items..."),id:"loading"},L={name:P("new-request-form.lookup-field.no-matches-found","No matches found"),id:"no-results"},E=t.useCallback(async e=>{try{const n=await fetch(`/api/v2/custom_objects/${R}/records/${e}`);if(n.ok){const{custom_object_record:e}=await n.json(),t={name:e.name,value:e.id};q(t),T(e.name)}}catch(e){console.error(e)}},[R]),M=t.useCallback(async t=>{const s=new URLSearchParams;s.set("name",t.toLocaleLowerCase()),s.set("source","zen:ticket"),s.set("field_id",i.toString()),s.set("requester_id",n.toString());const[r,o]=function(e,n=[]){const t=e?[...e.all.filter(e=>"matches"===e.operator||"not_matches"===e.operator),...e.any.filter(e=>"matches"===e.operator||"not_matches"===e.operator)]:[],s=t&&t[0]?.value.split("ticket_fields_")[1],a=n.find(e=>e.id.toString()===s);return[t[0]?.value,a?.value]}(e.relationship_filter,l),c=o?.toString()||"",u=`filter[dynamic_values][${r}]`;r&&s.set(u,c),a&&s.set("organization_id",a),I(!0);try{const e=await fetch(`/api/v2/custom_objects/${R}/records/autocomplete?${s.toString()}`),n=await e.json();if(e.ok){let e=n.custom_object_records.map(({name:e,id:n})=>({name:e,value:n}));C&&(e=e.filter(e=>e.value!==C.value),e=[C,...e]),_(e)}else _([])}catch(e){console.error(e)}finally{I(!1)}},[R,e.relationship_filter,i,a,C,n,l]),D=t.useMemo(()=>ee(M,300),[M]);t.useEffect(()=>()=>D.cancel(),[D]);const V=t.useCallback(({inputValue:e,selectionValue:n})=>{if(void 0!==n)if(""==n)q(ln),T(ln.name),_([]),r(ln.value);else{const e=k.find(e=>e.value===n);e&&(T(e.name),q(e),_([e]),r(e.value))}void 0!==e&&(T(e),D(e))},[D,r,k]);t.useEffect(()=>{m&&E(m)},[]);return s.jsxs(b,{children:[s.jsxs(g,{children:[c,h&&s.jsx(o,{"aria-hidden":"true",children:"*"})]}),f&&s.jsx(x,{dangerouslySetInnerHTML:{__html:f}}),s.jsxs(v,{inputProps:{required:h},"data-test-id":"lookup-field-combobox",validation:u?"error":void 0,inputValue:S,selectionValue:C?.value,isAutocomplete:!0,placeholder:P("new-request-form.lookup-field.placeholder","Search {{label}}",{label:c.toLowerCase()}),onFocus:()=>{T(""),M("*")},onChange:V,renderValue:()=>C?C?.name:ln.name,children:[C?.name!==ln.name&&s.jsx(y,{value:"",label:"-",children:s.jsx(me,{})}),F&&s.jsx(y,{isDisabled:!0,value:$.name},$.id),!F&&S?.length>0&&0===k.length&&s.jsx(y,{isDisabled:!0,value:L.name},L.id),!F&&0!==k.length&&k.map(e=>s.jsx(y,{value:e.value,label:e.name,"data-test-id":`option-${e.name}`},e.value))]}),u&&s.jsx(w,{validation:"error",children:u}),s.jsx("input",{type:"hidden",name:p,value:C?.value})]})}const un=f(Y)`
  margin: ${e=>e.theme.space.md} 0;
`,dn=f.form`
  display: flex;
  flex-direction: column;
  gap: ${e=>e.theme.space.md};
`,mn=f.div`
  margin-top: ${e=>e.theme.space.md};
`;function pn({requestForm:e,wysiwyg:n,newRequestPath:a,parentId:r,parentIdPath:o,locale:l,baseLocale:i,hasAtMentions:c,userRole:u,userId:m,brandId:p,organizations:h,answerBotModal:f}){const{ticket_fields:j,action:b,http_method:g,accept_charset:x,errors:v,parent_id_field:y,ticket_form_field:w,email_field:k,cc_field:_,organization_field:C,due_date_field:q,end_user_conditions:S,attachments_field:T,inline_attachments_fields:F,description_mimetype_field:P}=e,{answerBot:R}=f,{ticketFields:$,emailField:L,ccField:E,organizationField:M,dueDateField:D}=Ie({ticketFields:j,emailField:k,ccField:_,organizationField:C,dueDateField:q}),[V,z]=t.useState($),[A,N]=t.useState(M),[G,U]=t.useState(D),H=De(V,S),{formRefCallback:O,handleSubmit:X}=_e(V),{t:B}=d(),W=h.length>0&&h[0]?.id?h[0]?.id?.toString():null,Y=t.useCallback((e,n)=>{z(V.map(t=>t.name===e.name?{...t,value:n}:t))},[V]);const J=t.useCallback(e=>{null!==G&&U({...G,value:e})},[G]);return s.jsxs(s.Fragment,{children:[r&&s.jsx(un,{children:s.jsx(I,{href:o,children:B("new-request-form.parent-request-link","Follow-up to request {{parentId}}",{parentId:`‭#${r}‬`})})}),s.jsx(un,{"aria-hidden":"true",children:B("new-request-form.required-fields-info","Fields marked with an asterisk (*) are required.")}),s.jsxs(dn,{ref:O,action:b,method:g,acceptCharset:x,noValidate:!0,onSubmit:X,children:[v&&s.jsx(ne,{type:"error",children:v}),y&&s.jsx(ke,{field:y}),w.options.length>0&&s.jsx(we,{field:w,newRequestPath:a}),L&&s.jsx(ie,{field:L},L.name),E&&s.jsx(Xe,{field:E}),A&&s.jsx(pe,{field:A,onChange:e=>{!function(e){null!==A&&N({...A,value:e})}(e)}},A.name),H.map(e=>{switch(e.type){case"subject":return s.jsxs(t.Fragment,{children:[s.jsx(ie,{field:e,onChange:n=>Y(e,n)}),s.jsx(nn,{query:e.value,locale:l})]},e.name);case"text":case"integer":case"decimal":case"regexp":return s.jsx(ie,{field:e,onChange:n=>Y(e,n)},e.name);case"partialcreditcard":return s.jsx(We,{field:e,onChange:n=>Y(e,n)},e.name);case"description":return s.jsxs(t.Fragment,{children:[s.jsx(de,{field:e,hasWysiwyg:n,baseLocale:i,hasAtMentions:c,userRole:u,brandId:p,onChange:n=>Y(e,n)}),s.jsx("input",{type:"hidden",name:P.name,value:n?"text/html":"text/plain"})]},e.name);case"textarea":return s.jsx(de,{field:e,hasWysiwyg:!1,baseLocale:i,hasAtMentions:c,userRole:u,brandId:p,onChange:n=>Y(e,n)},e.name);case"priority":case"basic_priority":case"tickettype":return s.jsxs(t.Fragment,{children:[s.jsx(pe,{field:e,onChange:n=>Y(e,n)}),"task"===e.value&&s.jsx(Ve,{field:G,locale:i,valueFormat:"dateTime",onChange:e=>{J(e)}})]},e.name);case"checkbox":return s.jsx(he,{field:e,onChange:n=>Y(e,n)},e.name);case"date":return s.jsx(Ve,{field:e,locale:i,valueFormat:"date",onChange:n=>Y(e,n)},e.name);case"multiselect":return s.jsx(ve,{field:e},e.name);case"tagger":return s.jsx(Ye,{field:e,onChange:n=>Y(e,n)},e.name);case"lookup":return s.jsx(cn,{field:e,userId:m,organizationId:null!==A?A.value:W,onChange:n=>Y(e,n),visibleFields:H},e.name);default:return s.jsx(t.Fragment,{},e.name)}}),T&&s.jsx(Le,{field:T}),F.map(({type:e,name:n,value:t},a)=>s.jsx("input",{type:e,name:n,value:t},a)),s.jsx(mn,{children:(0===w.options.length||w.value)&&s.jsx(Z,{isPrimary:!0,type:"submit",children:B("new-request-form.submit","Submit")})})]}),R.auth_token&&R.interaction_access_token&&R.articles.length>0&&R.request_id&&s.jsx(on,{authToken:R.auth_token,interactionAccessToken:R.interaction_access_token,articles:R.articles,requestId:R.request_id,...f})]})}async function hn(t,a,r){const{baseLocale:o}=a;var l;l=o,e.use(n).init({resources:{[`${l}`]:{}},lng:l,lowerCaseLng:!0,interpolation:{escapeValue:!1},keySeparator:!1,pluralSeparator:"."}),await async function(n,t){try{const{default:s}=await t();e.addResourceBundle(n,"translation",s)}catch(e){console.error(`Cannot load translations for ${n}`)}}(o,()=>function(e){switch(e){case"./translations/locales/af.json":return import("af");case"./translations/locales/ar-x-pseudo.json":return import("ar-x-pseudo");case"./translations/locales/ar.json":return import("ar");case"./translations/locales/az.json":return import("az");case"./translations/locales/be.json":return import("be");case"./translations/locales/bg.json":return import("bg");case"./translations/locales/bn.json":return import("bn");case"./translations/locales/bs.json":return import("bs");case"./translations/locales/ca.json":return import("ca");case"./translations/locales/cs.json":return import("cs");case"./translations/locales/cy.json":return import("cy");case"./translations/locales/da.json":return import("da");case"./translations/locales/de-de.json":return import("de-de");case"./translations/locales/de-x-informal.json":return import("de-x-informal");case"./translations/locales/de.json":return import("de");case"./translations/locales/el.json":return import("el");case"./translations/locales/en-001.json":return import("en-001");case"./translations/locales/en-150.json":return import("en-150");case"./translations/locales/en-au.json":return import("en-au");case"./translations/locales/en-ca.json":return import("en-ca");case"./translations/locales/en-gb.json":return import("en-gb");case"./translations/locales/en-my.json":return import("en-my");case"./translations/locales/en-ph.json":return import("en-ph");case"./translations/locales/en-se.json":return import("en-se");case"./translations/locales/en-us.json":return import("en-us");case"./translations/locales/en-x-dev.json":return import("en-x-dev");case"./translations/locales/en-x-keys.json":return import("en-x-keys");case"./translations/locales/en-x-obsolete.json":return import("en-x-obsolete");case"./translations/locales/en-x-pseudo.json":return import("en-x-pseudo");case"./translations/locales/en-x-test.json":return import("en-x-test");case"./translations/locales/es-419.json":return import("es-419");case"./translations/locales/es-es.json":return import("es-es");case"./translations/locales/es.json":return import("es");case"./translations/locales/et.json":return import("et");case"./translations/locales/eu.json":return import("eu");case"./translations/locales/fa-af.json":return import("fa-af");case"./translations/locales/fa.json":return import("fa");case"./translations/locales/fi.json":return import("fi");case"./translations/locales/fil.json":return import("fil");case"./translations/locales/fo.json":return import("fo");case"./translations/locales/fr-ca.json":return import("fr-ca");case"./translations/locales/fr.json":return import("fr");case"./translations/locales/ga.json":return import("ga");case"./translations/locales/he.json":return import("he");case"./translations/locales/hi.json":return import("hi");case"./translations/locales/hr.json":return import("hr");case"./translations/locales/hu.json":return import("hu");case"./translations/locales/hy.json":return import("hy");case"./translations/locales/id.json":return import("id");case"./translations/locales/is.json":return import("is");case"./translations/locales/it-ch.json":return import("it-ch");case"./translations/locales/it.json":return import("it");case"./translations/locales/ja.json":return import("ja");case"./translations/locales/ka.json":return import("ka");case"./translations/locales/kk.json":return import("kk");case"./translations/locales/kl-dk.json":return import("kl-dk");case"./translations/locales/ko.json":return import("ko");case"./translations/locales/ku.json":return import("ku");case"./translations/locales/lt.json":return import("lt");case"./translations/locales/lv.json":return import("lv");case"./translations/locales/mk.json":return import("mk");case"./translations/locales/mn.json":return import("mn");case"./translations/locales/ms.json":return import("ms");case"./translations/locales/mt.json":return import("mt");case"./translations/locales/my.json":return import("my");case"./translations/locales/nl-be.json":return import("nl-be");case"./translations/locales/nl.json":return import("nl");case"./translations/locales/no.json":return import("no");case"./translations/locales/pl.json":return import("pl");case"./translations/locales/pt-br.json":return import("pt-br");case"./translations/locales/pt.json":return import("pt");case"./translations/locales/ro.json":return import("ro");case"./translations/locales/ru.json":return import("ru");case"./translations/locales/sk.json":return import("sk");case"./translations/locales/sl.json":return import("sl");case"./translations/locales/sq.json":return import("sq");case"./translations/locales/sr-me.json":return import("sr-me");case"./translations/locales/sr.json":return import("sr");case"./translations/locales/sv.json":return import("sv");case"./translations/locales/th.json":return import("th");case"./translations/locales/tr.json":return import("tr");case"./translations/locales/uk.json":return import("uk");case"./translations/locales/ur.json":return import("ur");case"./translations/locales/uz.json":return import("uz");case"./translations/locales/vi.json":return import("vi");case"./translations/locales/zh-cn.json":return import("zh-cn");case"./translations/locales/zh-tw.json":return import("zh-tw");default:return new Promise(function(n,t){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+e)))})}}(`./translations/locales/${o}.json`)),te.render(s.jsx(re,{theme:oe(t),children:s.jsx(pn,{...a})}),r)}export{hn as renderNewRequestForm};
